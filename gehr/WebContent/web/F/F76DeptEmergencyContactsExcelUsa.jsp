<%/***************************************************************************************//*   System Name  	: g-HR              																												*//*   1Depth Name		: Organization & Staffing                                                  													*//*   2Depth Name  	: Personnel Info                                                    															*//*   Program Name 	: Emergency Contacts																										*//*   Program ID   		: F76DeptEmergencyContactsExcelUsa.jsp                                   											*//*   Description  		: 부서별 비상연락망 Excel 저장을 위한 jsp 파일                      															*//*   Note         		: 없음                                                        																				*//*   Creation     		: 2010-10-11 jungin                                           																*//*   Update       :2017/08/28 eunha [CSR ID:3456352] 직급체계개편 후 직위/직책 표시 기준 변경에 따른 시스템 변경 요청 건      *//***************************************************************************************/%><%@ page contentType="text/html; charset=utf-8" %><%@ include file="../common/commonProcess.jsp" %><%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %><%@ page import="java.util.Vector" %><%@ page import="hris.common.*" %><%@ page import="hris.common.rfc.*" %><%@ page import="hris.F.*" %><%@ page import="hris.F.rfc.*" %><%@ page import="hris.common.util.*" %><%    request.setCharacterEncoding("utf-8");    WebUserData user = (WebUserData)session.getAttribute("user");            	//세션    String deptId = WebUtil.nvl(request.getParameter("hdn_deptId"));  			//부서코드    String deptNm = (WebUtil.nvl(request.getParameter("hdn_deptNm")));		//부서명    Vector DeptEmergencyContacts_vt = (Vector)request.getAttribute("DeptEmergencyContacts_vt");    /*----- Excel 파일 저장하기 --------------------------------------------------- */    response.setHeader("Content-Disposition","attachment;filename=Work_Experience.xls");    response.setContentType("application/vnd.ms-excel;charset=utf-8");    /*----------------------------------------------------------------------------- */%><html><head>    <title>MSS</title>    <meta http-equiv=Content-Type content="text/html; charset=utf-8">    <meta name=ProgId content=Excel.Sheet>    <meta name=Generator content="Microsoft Excel 9"></head><body bgcolor="#FFFFFF" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0"><form name="form1" method="post">    <%        //부서명, 조회된 건수.        if (DeptEmergencyContacts_vt != null && DeptEmergencyContacts_vt.size() > 0) {    %>    <table width="1200" border="0" cellspacing="0" cellpadding="0" align="center">        <tr>            <td width="16">&nbsp;</td>            <td >                <table width="100%" border="0" cellspacing="0" cellpadding="0" align="center">                    <tr>                        <td colspan="5" class="title02">* <spring:message code="LABEL.F.F76.0005" /><!-- Emergency Contacts --></td>                    </tr>                    <tr><td height="10"></td></tr>                    <tr>                        <td colspan="11" class="td09">&nbsp;<spring:message code="LABEL.F.F72.0004" /><!-- Org.Unit --> : <%= WebUtil.nvl(deptNm, user.e_obtxt) %></td>                        <td colspan="1"  class="td08">&lt;<spring:message code="LABEL.F.F72.0018" /><!-- Total Count --> : <%= DeptEmergencyContacts_vt.size() %> &gt;&nbsp;</td>                    </tr>                    <tr><td height="10"></td></tr>                </table>            </td>            <td width="16">&nbsp;</td>        </tr>        <tr>            <td width="16">&nbsp;</td>            <td >                <!-- 화면에 보여줄 영역 시작 -->                <table  border="1" cellspacing="1" cellpadding="4" class="table02">                    <tr>                        <td class="td03" nowrap><spring:message code="LABEL.F.F72.0001" /><!-- Corp. --></td>                        <td class="td03" nowrap><spring:message code="LABEL.F.F72.0002" /><!-- Pers. No. --></td>                        <td class="td03" nowrap><spring:message code="LABEL.F.F72.0003" /><!-- Name --></td>                        <td class="td03" nowrap><spring:message code="LABEL.F.F72.0004" /><!-- Org. Unit --></td>                        <td class="td03" nowrap><spring:message code="LABEL.F.F72.0005" /><!-- Res.of Office --></td>			            <%--CSR ID:3456352] 직급체계개편 후 직위/직책 표시 기준 변경에 따른 시스템 변경 요청 건 start--%>                        <%--<td class="td03" nowrap><spring:message code="LABEL.F.F72.0006" /><!-- Title of Level --></td> --%>                        <td class="td03" nowrap><spring:message code='MSG.A.A01.0083'/><!-- 직위/직급호칭 --></td>                         <%--CSR ID:3456352] 직급체계개편 후 직위/직책 표시 기준 변경에 따른 시스템 변경 요청 건 end--%>                        <td class="td03" nowrap><spring:message code="LABEL.F.F72.0007" /><!-- Level/Annu. --></td>                        <td class="td03" nowrap><spring:message code="LABEL.F.F72.0008" /><!-- Hiring Date --></td>                        <td class="td03" nowrap><spring:message code="LABEL.F.F76.0001" /><!-- Relationship --></td>                        <td class="td03" nowrap><spring:message code="LABEL.F.F76.0002" /><!-- Rel. Name --></td>                        <td class="td03" nowrap><spring:message code="LABEL.F.F76.0003" /><!-- Emerg. Ph#1 --></td>                        <td class="td03" nowrap><spring:message code="LABEL.F.F76.0004" /><!-- Emerg. Ph#2 --></td>                    </tr>                    <%                        HashMap empCnt = new HashMap();                        int cnt = 0;                        String oldPer = "";                        for (int i = 0; i < DeptEmergencyContacts_vt.size(); i++ ) {                            F76DeptEmergencyContactsDataUsa data = (F76DeptEmergencyContactsDataUsa)DeptEmergencyContacts_vt.get(i);                            if (oldPer.equals(data.PERNR) || (i==0)) {                                cnt ++;                            } else {                                empCnt.put(oldPer,new Integer(cnt));                                cnt = 1;                            }                            if (i == DeptEmergencyContacts_vt.size()-1){                                empCnt.put(data.PERNR,new Integer(cnt));                            }                            oldPer = data.PERNR;                        }                        oldPer="";                        String sRow = "";                        for (int i = 0; i < DeptEmergencyContacts_vt.size(); i++ ) {                            F76DeptEmergencyContactsDataUsa data = (F76DeptEmergencyContactsDataUsa)DeptEmergencyContacts_vt.get(i);                            if (oldPer.equals(data.PERNR)) {                                sRow = "";                            } else {                                sRow = "rowspan=" + empCnt.get(data.PERNR);                            }                            oldPer = data.PERNR;                    %>                    <tr align="center">                        <% if (!sRow.equals("")) { %>                        <td class="td09_1" nowrap <%=sRow %>>&nbsp;<%= data.NAME1 %>&nbsp;</td>                        <td class="td09_1" nowrap <%=sRow %>>&nbsp;<%= data.PERNR %>&nbsp;</td>                        <td class="td09_1" nowrap <%=sRow %>>&nbsp;<%= data.ENAME %>&nbsp;</td>                        <td class="td09_1" nowrap <%=sRow %>>&nbsp;<%= data.ORGTX %>&nbsp;</td>                        <td class="td09_1" nowrap <%=sRow %>>&nbsp;<%= data.JIKWT %>&nbsp;</td>                        <td class="td09_1" nowrap <%=sRow %>>&nbsp;<%= data.JIKKT %>&nbsp;</td>                        <td class="td09_1" nowrap <%=sRow %>>&nbsp;<%= data.JIKCT %>&nbsp;/&nbsp;<%= data.ANNUL %>&nbsp;</td>                        <td class="td09_1" nowrap <%=sRow %>>&nbsp;<%= (data.DAT01).replace("-","").replace(".","").equals("00000000") ? "" : WebUtil.printDate(data.DAT01) %>&nbsp;</td>                        <% } %>                        <td class="td09_1" nowrap>&nbsp;<%= data.RLSHPTX %>&nbsp;</td>                        <td class="td04" nowrap>&nbsp;<%= data.RLNAME %>&nbsp;</td>                        <td class="td04" nowrap>&nbsp;<%= WebUtil.insertStr(data.EMGPH1, "-", "3-3-4") %>&nbsp;</td>                        <td class="td04" nowrap>&nbsp;<%= WebUtil.insertStr(data.EMGPH2, "-", "3-3-4") %>&nbsp;</td>                    </tr>                    <%                        } //end for...                    %>                </table>            </td>            <td width="16">&nbsp;</td>        </tr>        <tr><td height="16"></td></tr>    </table>    <!-- 화면에 보여줄 영역 끝 -->    <%    } else {    %>    <table width="780" border="0" cellspacing="0" cellpadding="0" align="center">        <tr align="center">            <td  class="td04" align="center" height="25" ><spring:message code="LABEL.F.F51.0029" /><!-- No data --></td>        </tr>    </table>    <%        } //end if.    %></form></body></html>