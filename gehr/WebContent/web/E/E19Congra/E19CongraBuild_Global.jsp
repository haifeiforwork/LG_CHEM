<%/***************************************************************************************//*    System Name   : g-HR                                                                                                                          *//*   1Depth Name        : Application                                                                                                                   *//*   2Depth Name        : Benefit Management                                                                                                        *//*   Program Name   : Celebration & Condolence                                                                                              *//*   Program ID     : E19CongraBuild.jsp                                                                                                            *//*   Description        : 경조금 신청                                                                                                                            *//*   Note               : 없음                                                                                                                                        *//*   Creation           : 2005-02-14  이승희                                                                                                                   *//*   Update             : 2005-02-24  윤정현                                                                                                               *//*                          : 2005-12-07  @v1.1 lsa C2005112301000000543 경조화환 신청시 부서계좌 정보 조회기능 추가           *//*                          : 2005-12-29  @v1.2 lsa C2005122801000000122 돌반지제외                                                      *//*                          : 2006-01-18  @v1.3 lsa C2006011801000000150 경조금 신청 제한 한시적 오픈 요청                        *//*                                              @v1.4 lsa 통상금액(경조일 기준으로변경)                                                          *//*                                          @v1.5 lsa 급여작업으로 막음                                                                                 *//*                                          @v1.5 lsa 5월급여작업으로 막음  전문기술직만                                                       *//*                                          @v1.6 해외법인 임시로 품 71246:박선화                                                                  *//*                          : 2006-06-14  @v1.8 경조대상자 조회                                                                                        *//*                                          @v1.9 -조부모 회갑 경조금 폐지                                                                            *//*                                              -배우자 형제자매상 50% 지급 추가 (2006/6월/21일 오픈으로 이전 경조일data는 체크함)     *//*                                          @v2.0 -프로세스개선 임시 막음                                                                             *//*   Update             : 2007-10-23  li hui   @v2.1                                                                                            *//*                          : 2008-01-22  jungin  @v2.2  최대지급한도 추가.                                                                     *//*                          : 2008-11-03  jungin  @v2.3  [C20081031_51421] 수습직원 직계가족 조사 신청 가능 변경.(LG CCI한함) *//*                          : 2009-03-19  jungin  @v2.4  'Base Amount'영역 display 방지.(LG BOHAI한함)                                *//*                          : 2009-03-26  jungin  @v2.5  'Base Amount'영역 display 방지.(LG BOHAI한함) - 주석해제                 *//*                          : 2013-03-19  lixinxin  @v2.6   CSR：C20130315_92423 申??吊金的?候，以Cel / Con Date ?准算Service Period   ???? 10007591*//*                          : 2018-06-07 변지현 LGCLC 생명과학 북경법인(G610)  Rollout  프로젝트 적용 *//***************************************************************************************/%><%@ page contentType="text/html; charset=utf-8" %><%@ page errorPage="/web/err/error.jsp"%><%@ include file="/web/common/commonProcess.jsp" %><%@ page import="hris.common.*" %><%@ page import="java.util.Vector" %><%@ page import="hris.E.E19Congra.*" %><%@ page import="hris.E.E19Congra.rfc.*" %><%@ page import="hris.D.D05Mpay.rfc.*" %><%@ taglib prefix="tags" tagdir="/WEB-INF/tags" %><%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %><%@ taglib prefix="f" uri="http://www.lgchemhr.com/taglibs/functions" %><%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %><%@ taglib prefix="tags-approval" tagdir="/WEB-INF/tags/approval" %><%	PersonData phonenum = (PersonData)request.getAttribute("PersonData");	String E_BUKRS = phonenum.E_BUKRS;	String E_PERSG = phonenum.E_PERSG;    E19CongcondGlobalData data = (E19CongcondGlobalData)request.getAttribute("e19CongraData");    Vector famyCode         = (Vector)request.getAttribute("famyCode");    Vector vfamyCode = ( Vector)famyCode.get(0);    String PERNR = (String)request.getAttribute("PERNR");%><c:set var="user" value="<%=WebUtil.getSessionUser(request) %>"/><c:set var="phonenum" value="<%=phonenum %>"/><c:set var="E_BUKRS" value="<%=E_BUKRS %>"/><c:set var="E_PERSG" value="<%=E_PERSG  %>"/><c:set var="data" value="<%=data %>"/><c:set var="vfamyCode" value="<%=vfamyCode %>"/><c:set var="PERNR" value="${PERNR}"/><tags:layout css="ui_library_approval.css">    <tags-approval:request-layout titlePrefix="COMMON.MENU.ESS_BE_CONG_COND" >                    <tags:script>                    <script>$(function() {    if(parent.resizeIframe)   	parent.resizeIframe(document.body.scrollHeight);    <c:if test="${!isUpdate}">    document.form1.CELTY[0].selected = true;    document.form1.CELDT.value = "${f:printDate(f:currentDate())}";    </c:if>    <c:if test="${isUpdate}">    	day();    </c:if>});var tmpENAME="";var tmpOBJPS="";function day(){	flag = 1;	if (tmpENAME == "" && tmpOBJPS == ""){		if(typeof(form1.OBJPS) != 'undefined'){			tmpOBJPS = form1.OBJPS.value;		}		tmpENAME = form1.ENAME.value;	}	ajax_change2(document.form1.CELTY.value);}function beforeSubmit() {	if(doSubmit()){		return true;	};}function doSubmit() {    if(document.form1.CELTY.value == ""){        alert("<spring:message code='MSG.E.E19.0012' />"); //Please select Cel / Con Type.        return;    }    if(document.form1.FAMY_CODE.value == ""){        alert("<spring:message code='MSG.E.E19.0013' />"); //Please select Family Type.        return;    }    if(document.form1.ENAME.value == ""){        alert("<spring:message code='MSG.E.E19.0014' />"); //Please input Name.        return;    }    if((document.form1.CLAC_AMNT.value == "0")||(document.form1.CLAC_AMNT.value == "")){        alert("<spring:message code='MSG.E.E19.0015' />"); //There isn't fund to apply.        return;    }    if(document.form1.CELDT.value == ""){        alert("<spring:message code='MSG.E.E19.0016' />"); //Please input Cel / Con date.        return;    }    if(document.form1.check.value == "Y"){        alert("<spring:message code='MSG.E.E19.0017' />"); //Already Applied.Cannot duplicate applies.        return;    }        document.form1.BEGDA.value = removePoint(document.form1.BEGDA.value);        document.form1.CELDT.value = removePoint(document.form1.CELDT.value);        document.form1.BASE_AMNT.value = removeComma(document.form1.BASE_AMNT.value);        document.form1.CLAC_AMNT.value = removeComma(document.form1.CLAC_AMNT.value);        document.form1.MAXM_PAY.value = removeComma(document.form1.MAXM_PAY.value);    return true;}function reload() {    frm =  document.form1;    frm.jobid.value = "first";    frm.action = "${g.servlet}hris.E.E19Congra.E19CongraBuildGlobalSV";    frm.target = "";    frm.submit();}//----------- 가족유형을 선택할때 발생하는 function------------function ajax_change(tem){    if(tem == ""){        //alert("Please select Cel / Con Type.");        document.form1.CELTY.focus();        return;    }	var PERNR = "${PERNR}";	var CELTY = document.form1.CELTY.value;	var CELDT =  document.form1.CELDT.value;	var FAMSA = document.form1.FAMSA.value;	var FAMY_CODE = document.form1.FAMY_CODE.value;	var rmd = new Date().toString();    //var url = '/servlet/servlet.hris.E.E19Congra.E19CongraAjax';    //2013-03-19  lixinxin  @v2.6  CSR：C20130315_92423  替?代?begin    //var pars = 'Itype=' + tem+"&PERNR="+${PERNR}+"&CELTY=" + document.form1.CELTY.value + "&FAMSA="+ document.form1.FAMSA.value + "&FAMY_CODE=" + document.form1.FAMY_CODE.value  + "&rmd=" + new Date().toString();    //var pars = 'Itype=' + tem+"&PERNR="+${PERNR}+"&CELTY=" + document.form1.CELTY.value+"&CELDT=" + document.form1.CELDT.value + "&FAMSA="+ document.form1.FAMSA.value + "&FAMY_CODE=" + document.form1.FAMY_CODE.value  + "&rmd=" + new Date().toString();    //2013-03-19  lixinxin  @v2.6  CSR：C20130315_92423  替?代?end    //var myAjax = new Ajax.Request(url,{method: 'get',parameters: pars,onComplete: showResponse});    jQuery.ajax({        type:"POST",        url:'${g.servlet}hris.E.E19Congra.E19CongraAjax',        data: {Itype : tem, PERNR : PERNR, CELTY : CELTY , CELDT:CELDT,FAMSA:FAMSA,FAMY_CODE: FAMY_CODE,rmd:rmd},        success:function(data){        	showResponse(data);        },        error:function(e){            alert(e.responseText);        }    });}//----------- 경조 유형을 선택할때 발생하는 function-----------function ajax_change2(tem){	//2018-06-07 @PJ.LGCLC 생명과학 북경법인(G610)  Rollout  start	<c:if test = "${ (! empty E_BUKRS and ((E_BUKRS eq 'G100') or(E_BUKRS eq 'G610'))) and  (! empty E_PERSG and E_PERSG eq 'C' )}">	//2018-06-07 @PJ.LGCLC 생명과학 북경법인(G610)  Rollout  end        if(tem != "0003"){            if(tem == ""){                //alert("Please select Cel / Con Type.");            }else{                alert("<spring:message code='MSG.E.E19.0018' />"); //You can’t select this item!            }            tem = "";            document.form1.CELTY.value = "";            document.form1.FAMY_CODE.value = "";            $('#ename').html("");        }  </c:if>	var PERNR = "${PERNR}";	var FAMSA = document.form1.FAMSA.value;	var rmd = new Date().toString();   // var myAjax = new Ajax.Request(url,{method: 'get',parameters: pars,onComplete: showResponse2});    jQuery.ajax({        type:"POST",        url:'${g.servlet}hris.E.E19Congra.E19CongraAjax2',        data: {Itype:tem, PERNR : PERNR, CELTY : tem , FAMSA:FAMSA, rmd:rmd},        success:function(data){        	showResponse2(data);        },        error:function(e){           alert(e.responseText);        }    });}//--------------경조 신청 중복 체크 ----------------------function ajax_change1(){    var PERNR = "${PERNR}";    var CELTY = document.form1.CELTY.value;    var FAMSA = document.form1.FAMSA.value;    var FAMY_CODE = document.form1.FAMY_CODE.value;    var OBJPS = "";    var rmd = new Date().toString();    if(document.form1.FAMY_CODE.value== "0003"){        if(typeof(document.form1.OBJPS) == 'undefined'){            alert("<spring:message code='MSG.E.E19.0019' />"); //Please input family name.            return;        }		 OBJPS = document.form1.OBJPS.value    }    jQuery.ajax({        type:"POST",        url:'${g.servlet}hris.E.E19Congra.E19CongraAjax1',        data: {PERNR : PERNR, CELTY :CELTY , FAMSA:FAMSA ,FAMY_CODE: FAMY_CODE ,rmd:rmd ,OBJPS:OBJPS},        success:function(data){        	showResponse1(data);        },        error:function(e){            alert(e.responseText);        }    });   // var myAjax = new Ajax.Request(url,{method: 'get',parameters: pars+'&tmp='+d.toString(),onComplete: showResponse1});}function showResponse(originalRequest){//put returned XML in the textareaif (originalRequest!='') {    var arr= new Array();   arr=originalRequest.split('|');    $('#ename').html(unescape(arr[0]));    $('#base').html(arr[1]);    $('#paym').html(arr[2]);    $('#clac').html(arr[3]);    $('#limit').html(arr[4]);    $('#absn').html(arr[5]);    $('#syear').html(arr[6]);    form1.FAMSA.value = arr[7];    <c:if test="${isUpdate}">	if (tmpENAME == "" && tmpOBJPS == ""){		if(typeof(form1.OBJPS) != 'undefined'){			tmpOBJPS = form1.OBJPS.value;		}		tmpENAME = form1.ENAME.value;	}	</c:if>    }}function showResponse1(originalRequest){    //put returned XML in the textarea    $('#check').val( originalRequest );    if(doSubmit()){    	return true;    }}var flag = 0 ;function showResponse2(originalRequest){	 if (originalRequest != ""){        var arr= new Array();        arr=originalRequest.split('|');        $('#select').html(unescape(arr[0]));		if(flag == 1){			 var FAMY_CODE = document.form1.FAMY_CODE;		 	 for(var i = 0 ; i < FAMY_CODE.options.length ; i ++){			 	if(FAMY_CODE.options[i].value == '${data.FAMY_CODE}'){			 		FAMY_CODE.selectedIndex = i ;			 	}			 }			 flag = 0;		}    }}</script></tags:script></head><input type="hidden" name="OBJPStmp" value="${data.OBJPS }"/>    <div class="tableArea">        <div class="table">            <table class="tableGeneral">                <colgroup>                    <col width="15%"/>                    <col width="85%"/>                </colgroup>                 <tr>                    <th><span class="textPink">*</span><spring:message code='LABEL.E.E19.0018' /><!-- Cel / Con Type --></th>                    <td>                    <c:if test = "${!empty data }">                        <select name="CELTY" onChange="ajax_change2(this.options[this.options.selectedIndex].value)">                            <option value=""><spring:message code='LABEL.E.E21.0002' /><!-- Select --></option>                           			 ${ f:printCodeOption( vfamyCode , data.CELTY) }                        </select>					</c:if>                        <input type="hidden" name="CELTX" value="">                        <input type="hidden" name="BEGDA" value="${isUpdate? data.BEGDA : approvalHeader.RQDAT}">                    </td>                </tr>                <tr>                    <th><span class="textPink">*</span><spring:message code='LABEL.E.E24.0006' /><!-- Family Type --></th>                    <td>                        <span id="select" name="select">						<c:if test = "${!empty  data }">                            <select name="FAMY_CODE"  onpropertychange="ajax_change(this.options[this.options.selectedIndex].value)" onmouseup="ajax_change(this.options[this.options.selectedIndex].value)">                                <option value=""><spring:message code='LABEL.E.E21.0002' /><!-- Select --></option>                                <c:if test="${isUpdate}">                                	${f:printCodeOption(Code_vt3, data.FAMY_CODE)}                                </c:if>                            </select>                        </c:if>                        </span>                        <span class="commentOne"><spring:message code='LABEL.E.E19.0013' /><!-- Please&nbsp; register&nbsp; your&nbsp; families&nbsp;first. &nbsp;(Menu &nbsp;:&nbsp;Personnel &nbsp;HR &nbsp;Info&nbsp; -> &nbsp;Family) --></span>                        <input type="hidden" name="FAMSA" value="">                        <input type="hidden" name="FAMY_TEXT" value="">                        <input type="hidden" name="FAMTXT" value="">                    </td>                </tr>                <tr>                    <th><span class="textPink">*</span><spring:message code='LABEL.E.E29.0001' /><!-- Name --></th>                    <td>                        <span id="ename" name="ename">                        <input type="text" name="ENAME"  value="${ empty data.ENAME ? '' : data.ENAME }"    size="20" readonly>                        </span>                    </td>                </tr>                <tr>                    <th><span class="textPink">*</span><spring:message code='LABEL.E.E19.0014' /><!-- Cel / Con Date --></th>                    <td>                            <!-- 2013-03-19  lixinxin  @v2.6   CSR：C20130315_92423 增加事件 onpropertychange="ajax_change(document.form1.FAMY_CODE.value);"-->                            <c:choose>                            <c:when test="${data.CELDT !='' }">                        		<input type="text"  class="date" name="CELDT" value="${f:printDate(data.CELDT)}" size="7" onChange="ajax_change(document.form1.FAMY_CODE.value);" >                            </c:when>                            <c:otherwise>                            <input type="text"  class="date" name="CELDT" value="${f:printDate(f:currentDate())}" size="7" onChange="ajax_change(document.form1.FAMY_CODE.value);" >                            </c:otherwise>                            </c:choose>                    </td>                </tr>            </table>        </div>    </div>    <div class="tableArea" style="display:${user.empNo eq  PERNR ? 'block':'none'}">        <div class="table">          <table class="tableGeneral">                          <colgroup>                    <col width="15%"/>                    <col width="35%"/>                                        <col width="15%"/>                    <col width="35%"/>                </colgroup>								<tr>		        	  		   <th ><spring:message code='LABEL.E.E19.0015' /><!-- Base&nbsp;Amount --></th>                               <td><span id="base" name="base">                            	<input type="text" name="BASE_AMNT" style="text-align:right;" value="${f:printNumFormat(data.BASE_AMNT,2) }"  size="10" readonly>&nbsp;<input type="text" name="CURRENCY"  value="${ data.CURRENCY }" readonly>                                </span>                               </td>                               <th class="th02"><spring:message code='LABEL.E.E21.0013' /><!-- Payment&nbsp;Rate --></th>                               <td  ><span id="paym" name="paym">                            	<input type="text" name="PAYM_RATE" style="text-align:right;" value="${f:printNumFormat(data.PAYM_RATE,2) }"   size="10" readonly>&nbsp;<input type="text"  value="%" readonly>                               </span>                               </td>		        	  		 </tr>	                    	 <tr>		        	  		   <th ><spring:message code='LABEL.E.E20.0041' /><!-- Payment&nbsp;Amount --></th>                               <td >                               <span id="clac" name="clac">                            	<input type="text" name="CLAC_AMNT" style="text-align:right;" value="${f:printNumFormat(data.CLAC_AMNT,2) }"  size="10" readonly>&nbsp;<input type="text" name="CURRENCY"   value="${data.CURRENCY }" readonly>                               </span>                               </td>                               <th class="th02"><spring:message code='LABEL.E.E19.0016' /><!-- Payment&nbsp;Limit --></th>                               <td ><span id="limit" name="limit">                            	<input type="text" name="MAXM_PAY" style="text-align:right;"  value="${f:printNumFormat(data.MAXM_PAY,2) }"  size="10" readonly>&nbsp;<input type="text"  name="CURRENCY" value="${ data.CURRENCY }" readonly>                               </span>                               </td>		        	  		 </tr>		        	  		 <tr>                             <th ><spring:message code='LABEL.E.E19.0017' /><!-- Absence Days --></th>                    <td>                        <span id="absn" name="absn">                            <input type="text" name="ABSN_DATE" style="text-align:right;" value="${data.ABSN_DATE}" size="10" readonly>&nbsp;<input type="text"   value="Days" readonly>                        </span>                    </td>                    <th class="th02"><spring:message code='LABEL.E.E05.0003' /><!-- Service Period --></th>                    <td>                        <span id="syear" name="syear" >                            <input type="text" name="SYEAR" style="text-align:right;" value="${data.SYEAR}" size="6" readonly>&nbsp;<input type="text" value="Year"    readonly size="5">                            <input type="text" name="SMNTH" style="text-align:right;" value="${data.SMNTH}"  size="6" readonly>&nbsp;<input type="text" value="Month"   readonly size="5">                        </span>                    </td>                </tr>            </table>            <span class="commentOne" style="display:"${user.empNo eq  PERNR ? 'block':'none'}"><span class="textPink">*</span><spring:message code='LABEL.E.E18.0059' /><!-- Required Field --></span>        </div>    </div>   <input type="hidden" name="check"  value="">  <input type="hidden" name="AWART"  value="${data.AWART }">    </tags-approval:request-layout></tags:layout>