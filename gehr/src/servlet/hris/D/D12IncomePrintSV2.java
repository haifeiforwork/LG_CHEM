package	servlet.hris.D;import java.io.*;import java.sql.*;import java.util.Vector;import javax.servlet.*;import javax.servlet.http.*;import com.sns.jdf.*;import com.sns.jdf.db.*;import com.sns.jdf.util.*;import com.sns.jdf.servlet.*;import hris.common.*;import hris.D.D11TaxAdjust.*;import hris.D.D11TaxAdjust.rfc.*;/** * D12IncomePrintSV.java * 소득공제신고서 출력을 위한 Class * * @author 김성일 * @version 1.0, 2002/01/21 */public class D12IncomePrintSV2 extends EHRBaseServlet {	protected void performTask(HttpServletRequest req, HttpServletResponse res) throws GeneralException {        try{        	//ApLog        	String ctrl = "";        	String cnt = "0";        	String[] val = null;            HttpSession  session          = req.getSession(false);            WebUserData  user             = (WebUserData)session.getAttribute("user");            String print_seq 				= (String) session.getAttribute("PNT_SEQ"); //@2014 연말정산 소득공제신고서 부서seq 추가            String pdfOnlyYN 				= (String) session.getAttribute("PDF_ONLY_YN"); //@2014 연말정산 오직 PDF만 사용한건지에 대한  YN 표시            Box          box              = WebUtil.getBox(req);//            D11TaxAdjustRFC        rfc              = new D11TaxAdjustRFC();            //D11TaxAdjustReturnData returnData       = null;            //Vector                 personalRed_vt   = null;            //Vector                 specialRed_vt    = null;            //Vector                 etcRed_vt        = null;            String dest  = "";            String jobid = box.get("jobid");            if( jobid.equals("") ){                jobid = "first";            }            String targetYear = box.get("targetYear");   //[?????]  targetYear => 요거 변수명 바뀔수도 있음            if( targetYear.equals("") ){                targetYear = ((TaxAdjustFlagData)session.getAttribute("taxAdjust")).targetYear;            }            if( jobid.equals("first") ){                String print_page_name = WebUtil.ServletURL + "hris.D.D12IncomePrintSV2?jobid=print&targetYear="+targetYear;                req.setAttribute( "print_page_name", print_page_name );                /*String print_page_name2 = WebUtil.ServletURL + "hris.D.D11TaxAdjust.D11TaxAdjustMedicalSV?jobid=print&targetYear="+targetYear;                req.setAttribute( "print_page_name2", print_page_name2 );                String print_page_name3 = WebUtil.ServletURL + "hris.D.D11TaxAdjust.D11TaxAdjustGibuSV?jobid=print&targetYear="+targetYear+"&PERNR="+user;                req.setAttribute( "print_page_name3", print_page_name3 );                String print_page_name4 = WebUtil.ServletURL + "hris.D.D11TaxAdjust.D11TaxAdjustCardSV?jobid=print&targetYear="+"&tab_gubun=1";//tab 구분은 뭔지 몰겠지만 1이어서...                req.setAttribute( "print_page_name4", print_page_name4 );*/                dest =  WebUtil.JspURL + "common/printFrame.jsp";                //ApLog                ctrl = "22";            } else if( jobid.equals("print") ){                D11TaxAdjustPersonRFC  rfc01 = new D11TaxAdjustPersonRFC();                D11TaxAdjustSpecialRFC rfc02 = new D11TaxAdjustSpecialRFC();                //D11TaxAdjustEduRFC     rfc03 = new D11TaxAdjustEduRFC();                D11TaxAdjustEducationRFC rfc03 = new D11TaxAdjustEducationRFC();                D11TaxAdjustTaxRFC     rfc04 = new D11TaxAdjustTaxRFC();                D11TaxAdjustMedicalRFC rfc05 = new D11TaxAdjustMedicalRFC();                D11TaxAdjustFamilyRFC  rfc06 = new D11TaxAdjustFamilyRFC();                D11TaxAdjustPreWorkRFC rfc07 = new D11TaxAdjustPreWorkRFC();                D11TaxAdjustPensionRFC  rfc08 = new D11TaxAdjustPensionRFC();                D11TaxAdjustRentRFC       rfc09        = new D11TaxAdjustRentRFC();                D11TaxAdjustHouseLoanRFC rfc10 = new D11TaxAdjustHouseLoanRFC();//@2015 연말정산 추가 탭                Vector person_vt = new Vector();                Vector special_vt = new Vector();                Vector edu_vt     = new Vector();                Vector tax_vt      = new Vector();                Vector medi_vt    = new Vector();                Vector family_vt  = new Vector();                Vector preWork_vt = new Vector();                Vector preWorkHeadNm_vt = new Vector();                Vector pension_vt = new Vector();                Vector rent_vt = new Vector();                Vector houseLoan_vt = new Vector();                String tab_gubun ="1";                person_vt  = rfc01.getPerson( user.empNo, targetYear );                special_vt = rfc02.getSpecial( user.empNo, targetYear,"1" );                edu_vt     = rfc03.getEdu( user.empNo, targetYear );                tax_vt     = rfc04.getTax( user.empNo, targetYear,"1" );                medi_vt    = rfc05.getMedical( user.empNo, targetYear );                family_vt  = rfc06.getFamily( user.empNo, targetYear,"1" );                preWork_vt = rfc07.getPreWork( user.empNo, targetYear );                preWorkHeadNm_vt = rfc07.getPreWorkHeaderNm( user.empNo, targetYear );            	pension_vt   = rfc08.getPension( user.empNo, targetYear );            	rent_vt   = rfc09.getRent( user.empNo, targetYear );            	houseLoan_vt = rfc10.getHouseLoan(user.empNo, targetYear);//@2015 연말정산 추가                req.setAttribute( "targetYear", targetYear );                req.setAttribute( "person_vt" , person_vt  );                req.setAttribute( "special_vt", special_vt );                req.setAttribute( "edu_vt"    , edu_vt     );                req.setAttribute( "tax_vt"    , tax_vt     );                req.setAttribute( "medi_vt"   , medi_vt    );                req.setAttribute( "family_vt" , family_vt  );                req.setAttribute( "preWork_vt", preWork_vt  );                req.setAttribute( "pension_vt" , pension_vt     );                req.setAttribute( "rent_vt" , rent_vt     );                req.setAttribute( "preWorkHeadNm_vt", preWorkHeadNm_vt  );                req.setAttribute( "PNT_SEQ", print_seq);////@2014 연말정산 소득공제신고서 seq 추가                req.setAttribute( "PDF_ONLY_YN", pdfOnlyYN);////@2014 연말정산 소득공제신고서 seq 추가                req.setAttribute("houseLoan_vt", houseLoan_vt);//@2015 연말정산 주택자금 상환 추가                //@card 내역 추가                Vector cardData_vt = new Vector();                Vector card_vt    = new Vector();                D11TaxAdjustCardRFC   rfc   = new D11TaxAdjustCardRFC();//@2014 연말정산                cardData_vt = rfc.getCard( user.empNo, targetYear,tab_gubun );                for( int i = 0 ; i < cardData_vt.size() ; i++ ) {                    D11TaxAdjustCardData data = (D11TaxAdjustCardData)cardData_vt.get(i);                    data.BETRG = Double.toString(Double.parseDouble(data.BETRG)*100 );                    data.BETRG_B = Double.toString(Double.parseDouble(data.BETRG_B)*100 );                    data.BETRG_M = Double.toString(Double.parseDouble(data.BETRG_M)*100 );                    data.BETRG_O = Double.toString(Double.parseDouble(data.BETRG_O)*100 );                    card_vt.addElement(data);                }                req.setAttribute( "targetYear", targetYear );                req.setAttribute( "card_vt"   , card_vt    );                req.setAttribute( "tab_gubun" , tab_gubun  );                //@card 내역 추가 끝                //@의료비 내역 추가                Vector mediData_vt = new Vector();                Vector medi_vt2 = new Vector();                D11TaxAdjustMedicalRFC   rfcMedic   = new D11TaxAdjustMedicalRFC();                mediData_vt = rfcMedic.getMedical( user.empNo, targetYear );                for( int i = 0 ; i < mediData_vt.size() ; i++ ) {                    D11TaxAdjustMedicalData data = (D11TaxAdjustMedicalData)mediData_vt.get(i);                    data.CA_BETRG = Double.toString(Double.parseDouble(data.CA_BETRG)*100 );                    medi_vt2.addElement(data);                }                req.setAttribute( "targetYear", targetYear );                req.setAttribute( "medi_vt2"   , medi_vt2    );                //@의료비 내역 추가 끝                //@기부금 내역 추가                Vector gibuData_vt = new Vector();                Vector gibu_vt = new Vector();                D11TaxAdjustGibuRFC   rfcGibu   = new D11TaxAdjustGibuRFC();                gibuData_vt = rfcGibu.getGibu( user.empNo, targetYear );                for( int i = 0 ; i < gibuData_vt.size() ; i++ ) {                    D11TaxAdjustGibuData data = (D11TaxAdjustGibuData)gibuData_vt.get(i);                    data.DONA_AMNT = Double.toString(Double.parseDouble(data.DONA_AMNT)*100 );                    data.DONA_DEDPR = Double.toString(Double.parseDouble(data.DONA_DEDPR)*100 ); // @2011 전년까지 공제된 금액                    gibu_vt.addElement(data);                }                req.setAttribute( "targetYear", targetYear );                req.setAttribute( "gibu_vt"   , gibu_vt    );                //@기부금 내역 추가 끝                dest = WebUtil.JspURL+"D/D12IncomePrint2.jsp";                //ApLog                ctrl = "23";            }            Logger.debug.println( this, " destributed = " + dest );            //ApLog 생성            ApLoggerWriter.writeApLog("연말정산", "소득공신고서발행", "D12IncomePrintSV", "소득공신고서발행", ctrl, cnt, val, user, req.getRemoteAddr());            printJspPage(req, res, dest);        } catch(Exception e) {        	//Logger.error(e);            throw new GeneralException(e);        }	}}